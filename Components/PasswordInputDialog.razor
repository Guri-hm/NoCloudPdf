@using Microsoft.AspNetCore.Components.Web

@if (IsOpen)
{
    <div class="fixed inset-0 z-[200] flex items-center justify-center bg-black">
        <div class="bg-white rounded-lg shadow-lg w-80 p-6 animate-fade-in">
            <h2 class="text-lg font-bold mb-2 text-gray-800">パスワード入力</h2>
            <div class="mb-4 text-sm text-gray-700">
                「@FileName」はパスワード付きPDFです。パスワードを入力してください。
            </div>
            <input type="password"
                class="w-full border border-gray-300 rounded px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400"
                @bind="Password" @onkeyup="OnKeyUp" placeholder="パスワード" autofocus />
            <div class="flex justify-end gap-2">
                <button type="button" class="px-4 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition"
                    @onclick="Cancel">
                    キャンセル
                </button>
                <button class="px-4 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 transition" @onclick="Submit">
                    OK
                </button>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public string FileName { get; set; } = "";
    [Parameter] public EventCallback<string?> OnClose { get; set; }

    private string Password { get; set; } = "";
    private async Task Submit()
    {
        Console.WriteLine($"ダイアログから受け取ったパスワード: {Password}");
        await OnClose.InvokeAsync(Password);
        Password = "";
    }

    private async Task Cancel()
    {
        await OnClose.InvokeAsync(null);
        Password = "";
    }

    private async Task OnKeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await Submit();
        }
        else if (e.Key == "Escape")
        {
            await Cancel();
        }
    }
}