@inject NavigationManager Navigation
@inject NavigationManager Nav
@using NoCloudPdf.Components

<div class="py-1 flex items-center justify-between md:flex-col md:h-screen md:py-4 md:w-auto">
    <!-- アプリアイコンエリア -->
    <div class="md:w-full md:flex md:justify-center md:mb-4">
        <a class="text-white" href="@Nav.BaseUri">
            <img src="img/logo.webp" alt="NoCloudPDF" class="w-12 h-12 object-contain" />
        </a>
    </div>
    
    <!-- モバイルヘッダー -->
    <span class="text-white font-bold ml-4 md:hidden">
        @GetPageTitle()
    </span>
    <button id="nav-hamburger" title="Navigation menu"
        class="relative w-12 h-12 flex flex-col justify-center items-center md:hidden focus:outline-none btn-trigger @(collapseNavMenu ? "" : "active")"
        @onclick="ToggleNavMenu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- オーバレイ（ヘッダー以外を覆う） -->
    <div class=@($"fixed inset-0 top-[56px] bg-black transition-opacity duration-[500ms] ease-in-out z-60 md:hidden {(collapseNavMenu ? "opacity-0 pointer-events-none" : "opacity-50")}")
         @onclick="ToggleNavMenu"></div>

    <!-- 機能アイコンエリア -->
    <div class=@($"fixed top-[56px] left-0 w-full md:static md:w-auto md:flex-1 md:overflow-y-auto z-70 sidebar transition-opacity duration-[500ms] navmenu-sidebar-bg ease-in-out md:opacity-100 md:pointer-events-auto md:block {(collapseNavMenu ? "opacity-0 pointer-events-none" : "opacity-100")} max-w-[100vw]")
         style="max-width:100vw;">
        <nav id="nav-main"
             class="w-full mt-4 flex flex-row flex-wrap justify-start gap-4 px-4 pb-4 md:flex-col md:flex-wrap md:gap-y-2 md:gap-x-0 md:px-2 md:max-h-[calc(100vh-120px)]">
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="merge">
                <MergeIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">結合</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="split">
                <SplitIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">分割</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="layout">
                <LayoutIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">レイアウト</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="trim">
                <TrimIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">トリミング</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="slice">
                <SliceIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">スライス</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="edit">
                <EditIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">編集</span>
            </NavLink>
            <NavLink class="flex flex-col items-center py-2 text-white hover:bg-gray-700/70 rounded-lg transition flex-none min-w-[72px] md:w-16"
                href="ocr">
                <OcrIcon Class="w-8 h-8" />
                <span class="text-[10px] mt-1 opacity-80">文字認識</span>
            </NavLink>
        </nav>
    </div>
</div>

@code {
    private bool collapseNavMenu = true;

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private string GetPageTitle()
    {
        var uri = Navigation.Uri.ToLower();
        if (uri.EndsWith("/merge")) return "結合";
        if (uri.EndsWith("/split")) return "分割";
        if (uri.EndsWith("/edit")) return "編集";
        if (uri.EndsWith("/trim")) return "トリミング";
        if (uri.EndsWith("/layout")) return "レイアウト";
        if (uri.EndsWith("/slice")) return "スライス";
        if (uri.EndsWith("/ocr")) return "文字認識";
        if (uri.EndsWith("/") || uri.EndsWith("")) return "NoCloudPDF";
        return "";
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}